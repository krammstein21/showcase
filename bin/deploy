#!/usr/bin/env bash
cd $(dirname $(dirname $(readlink -f $0)))

if [ ! -f db/htpasswd ]
then
  htpasswd -b -c db/htpasswd bootstrap password
fi

bin/rails assets:precompile
chown app:app /etc/nginx/sites-enabled
runuser -u app ruby config/tenant/nginx-config.rb

grep -q $(pwd) /etc/nginx/sites-enabled/showcase.con 2>/dev/null && \
  passenger-config restart-app .
test -e /run/nginx.pid && nginx -s reload

exit 0
