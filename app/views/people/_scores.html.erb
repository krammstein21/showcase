<table class="" style="break-after: page">
  <thead>
    <tr>
      <td colspan="6" class="font-bold pt-8 text-3xl pb-5" >
        <%= person.name %>
        <span class="font-normal text-base float-right">
          <%= @event.name %>
        </span>
      </td>
    </tr>
    <tr>
      <td class="row-head">Heat
      <td class="row-head" colspan="<%= [@judges.length, 1].max %>">Scores
      <td class="row-head">Dance
      <td class="row-head">Partner
      <td class="row-head" colspan="3">Lvl/Cat
    </tr>
  </thead>
  <tbody>
    <% @heats.each do |heat| %>
    <% next unless [heat.entry.lead, heat.entry.follow].include? person %>
    <tr class="text-sm">
      <td class="text-center"><%= heat.number %>
      <% if @judges.empty? %>
      <td></td>
      <% else %>
      <% @judges.each do |judge| %>
        <td class="text-center"><%= heat.scores.select {|score| score.judge == judge}.sort_by(&:slot).map(&:value).join(' ') %>
      <% end %>
      <% end %>
      <td><div class="mx-4"><%= heat.category %> <%= heat.dance.name %></div>
      <% if heat.entry.lead != person %>
      <td><div class="mx-4"><%= link_to heat.entry.lead.display_name, heat.entry.lead %></div>
      <% end %>
      <% if heat.entry.follow != person %>
      <td><div class="mx-4"><%= link_to heat.entry.follow.display_name, heat.entry.follow %></div>
      <% end %>
      <% lvlcat = heat.entry.subject_lvlcat.split(/\s*-\s*/) %>
      <td class="pl-4 text-right"><%= lvlcat[0] %>
      <td class="pl-1">- <%= lvlcat[1] %>
      <% if @track_ages %>
      - <td class="text-left"><%= lvlcat[2].strip %>
      <% end %>
    </tr>
    <% end %>
  </tbody>

  <% if @heats.select {|heat| heat.scores.any? {|score| score.comments}} %>
  <% @heats.each do |heat| %>
  <% next unless [heat.entry.lead, heat.entry.follow].include? person %>
  <% next unless heat.scores.any? {|score| score.comments} %>
  <tbody>
    <tr>
      <td colspan="5" class="text-center py-4 font-bold text-xl">Solo comments
    </tr>
    <% heat.scores.each do |score| %>
    <% next unless score.comments %>
    <tr>
      <td class="text-center"><%= heat.number %>
      <td colspan="4"><%= score.comments %>
    </tr>
    <% end %>
  </tbody>
  <% end %>
  <% end %>
</table>