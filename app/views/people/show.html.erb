<div class="mx-auto md:w-2/3 w-full flex">
  <div class="mx-auto">
    <% if notice.present? %>
      <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-lg inline-block" id="notice"><%= notice %></p>
    <% end %>

    <% if @person.type == 'Student' %>
    <%= link_to 'Add heats', new_entry_path(primary: @person), class: "btn-blue float-right" %>
    <% end %>

    <%= render @person %>

    <% if %w(Student Professional).include? @person.type %>

    <% unless @heats.empty? %>
    <h2 class="font-bold pt-8 text-3xl pb-5">Entries</h2>

    <table>
      <thead>
        <th>count
        <th>partner
        <th>level
        <th>age
      </thead>

      <tbody>
        <% @entries.each do |partner, entries| %>
          <% entries.each do |entry| %>
            <tr class="group">
              <td class="row text-right"><%= entry.heats.length %>
              <td class="row"><%= link_to partner.display_name, partner %>
              <td class="row"><%= entry.level.name %>
              <td class="row"><%= entry.age.category %>
              <td>
              <form method="get" action="<%= edit_entry_path(entry) %>">
              <input type="hidden" name="primary" value="<%= @person.id %>">
              <button type="submit" class='group-hover:inline hidden x-2 rounded-lg py-1 px-2 text-white bg-blue-600 font-medium'>Edit</button>
              </form>
              </td>
            </tr>
          <% end %>
        <% end %>
        <tr>
          <td class="border-t-2 border-gray-200 row text-right"d><%= @entries.values.flatten.map {|entry| entry.heats.length}.sum %>
          <th colspan="3" class="border-t-2 border-gray-200 row text-center font-bold">total
        </tr>
      </tbody>
    </table>

    <h2 class="font-bold pt-8 text-3xl pb-5">Dances</h2>

    <table>
      <thead>
      <td></td>
      <% @partners.each do |partner| %>
        <td class="row-head-main">
          <%= link_to partner.first_name, partner %>
        </td>
      <% end %>
      </thead>

      <tbody>
      <% @dances.each do |dance, partners| %>
      <tr>
        <td><%= dance.name %></td>
        <% @partners.each do |partner| %>
          <td class="row text-center"><%= partners[partner] %></td>
        <% end %>
      </tr>
      <% end %>
      </tbody>
    </table>

    <h2 class="font-bold pt-8 text-3xl pb-5" id="heats">Heats</h2>

    <table>
      <thead>
        <tr>
          <td class="row-head">Heat
          <td class="row-head">Category
          <td class="row-head">Dance
          <td class="row-head">Lead
          <td class="row-head">Follow
          <td class="row-head">Level
          <td class="row-head">Age
        </tr>
      </thead>
      <tbody>
        <% @heats.each do |heat| %>
        <tr>
          <td class="row"><%= link_to heat.number, heats_path(anchor: "heat-#{heat.number}")  %>
          <td class="row"><%= heat.category %>
          <td class="row"><%= heat.dance.name %>
          <td class="row"><%= link_to heat.entry.lead.display_name, heat.entry.lead %>
          <td class="row"><%= link_to heat.entry.follow.display_name, heat.entry.follow %>
          <td class="row"><%= heat.entry.level.name %>
          <td class="row"><%= heat.entry.age.category %>
        </tr>
        <% end %>
      </tbody>
    </table>
    <% end %>
    <% end %>

    <div class="mt-4 mx-auto">
    <%= link_to 'Edit this person', edit_person_path(@person), class: "btn-blue" %>

    <% if @person.type == 'Student' %>
    <%= link_to 'Add heats', new_entry_path(primary: @person), class: "btn-blue" %>
    <% end %>

    <%= link_to 'Back to studio', @person.studio, class: "btn-green" %>
    </div>
  </div>
</div>
