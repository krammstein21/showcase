<div class="flex flex-col h-screen max-h-full w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-lg inline-block" id="notice"><%= notice %></p>
  <% end %>

  <h1 class="grow font-bold text-4xl pt-1 pb-3 text-center">
    <%= link_to judge_heatlist_path(judge: @judge, anchor: dom_id(@heat)), rel: 'up' do %>
      <span>Heat <%= @number %>:<br class="block sm:hidden"> <%= @dance %></span>
    <% end %>

    <% if @heat.dance.heat_length %>
    <div class="text-2xl font-normal">
    Dance <%= @slot %> of <%= @heat.dance.heat_length %>:
    <% slots = @heat.dance.multi_children.group_by {|multi| multi.slot} %>
    <% if slots.length > 1 %>
    <%= slots[@slot].sort_by {|multi| multi.dance.order}.map {|multi| multi.dance.name}.join(' / ') %>
    <% elsif slots.values.last.length == @heat.dance.heat_length %>
    <%= slots.values.last.sort_by {|multi| multi.dance.order}[@slot - 1].dance.name %>
    <% else %>
    <%= slots.values.last.sort_by {|multi| multi.dance.order}.map {|multi| multi.dance.name}.join(' / ') %>
    <% end %>
    </div>
    <% end %>
  </h1>


<div data-controller="info-box">
<div class="info-button top-2">&#x24D8;</div>
<ul class="info-box">
<li>Scoring can be done multiple ways:
<ul class="list-disc ml-4">
<li>Drag and drop: Drag an entry box to the desired score.  
<li>Point and click: Clicking on a entry back and then clicking on score.  Clicking on the back number again unselects it.
<li>Keyboard: tab to the desired entry back, then move it up and down using the keyboard.  Clicking on escape unselects the back.
</ul>
<li>Dragging an entry back to the unlabelled box at the right returns the participant to the unscored state.
<li>Clicking on the arrows at the bottom corners will advance you to the next or previous heats.
Left and right arrows on the keyboard may also be used.
Swiping left and right on mobile devices and tablets also work.
<li>Clicking on the heat information at the top center of the page will return you to the heat list where you can quickly scroll and select a different heat.
</ul>
</div>

  <div class="h-full flex flex-row max-h-[85%]"
    data-controller="score" data-drop-action="<%=  post_score_path(judge: @judge) %>" 
    data-start-action="<%= start_heat_event_index_path %>" data-heat="<%= @number %>"
    <% if @slot %>data-slot="<%= @slot %>"<% end %>>
    <div class="grow flex flex-col border-2 border-slate-400">
    <div class="hidden text-red-600 text-4xl" data-score-target="error"></div>
    <% @scores.each do |score| %>
    <% if score == '' %>
    </div><div class="my-auto h-full max-w-[30%] min-w-[30%] border-2 border-slate-400
       flex flex-col flex-wrap pl-4" data-score="<%= score %>">
    <% else %>
    <div class="flex flex-wrap border-2 h-full pl-4" data-score="<%= score %>">
    <% end %>
      <span class="order-2 ml-auto p-2"><%= score %></span>

      <% @results[score]&.each do |subject| %>
        <% lvl = subject.entry.level.initials %>
        <div class='grid align-middle w-20 my-[1%] min-h-[12%] sm:min-h-[24%] mx-1 border-2 rounded-lg text-center head-<%=lvl%>' draggable="true" data-heat="<%= subject.id %>" id="<%= dom_id subject %>">
          <% if @backnums %>
          <span class="font-bold text-xl my-auto"><%= subject.entry.lead.back %></span>
          <% elsif subject.entry.follow.type == 'Professional' %>
          <span class="text-l my-auto"><%= subject.entry.lead.back_name %>
          <%= subject.entry.follow.back_name %></span>
          <% else %>
          <span class="text-l my-auto"><%= subject.entry.follow.back_name %>
          <%= subject.entry.lead.back_name %></span>
          <% end %>
          <div class="hidden text-sm sm:block base-<%=lvl%>"><br>
          <%= subject.entry.subject_category %><br>
          <%= lvl %></div>
        </div>  
    <% end %>
    <% if score != '' %>
    </div>
    <% end %>
    <% end %>
    </div>
  </div>

  <div class="mt-2 flex flex-row w-full">
    <div class="align-middle">
      <% if @prev %>
      <%= link_to '<<', @prev, class: 'text-2xl lg:text-4xl', rel: 'prev' %>
      <% end %>
    </div>

    <h1 class="font-bold text-2xl pt-1 pb-3 flex-1 text-center">
      <%= link_to @judge.display_name, person_path(@judge) %>
      <%= link_to root_path do %>
        <%= image_tag showcase_logo, class: "absolute right-4 top-4 h-8" %>
      <% end %>
    </h1>

    <div class="align-middle">
      <% if @next %>
      <%= link_to '>>', @next, class: 'text-2xl lg:text-4xl', rel: 'next' %>
      <% end %>
  </div>
  </div>
</div>
